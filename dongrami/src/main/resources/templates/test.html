<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>댓글 추가</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <form id="replyForm">
        <label for="content">내용:</label>
        <input type="text" id="content" name="content" required><br><br>
        <input type="hidden" id="level" name="level" value="1"><br><br>
        <input type="hidden" id="voteId" name="voteId" value=""><br><br> <!-- hidden input -->
        <input type="hidden" id="userId" name="userId" th:value="${session.loggedInUser.userId}"><br><br> <!-- hidden input -->
        <span th:text="${session.loggedInUser.nickname}">사용자 이름</span>
        <input type="hidden" id="userNicknameInput" name="userNickname" th:value="${session.loggedInUser.nickname}"><br><br>
        <button type="submit">댓글 작성</button>
    </form>

    <script>
        // URL에서 voteId를 추출하여 hidden input에 설정
        document.addEventListener('DOMContentLoaded', (event) => {
            const urlParams = new URLSearchParams(window.location.search);
            const voteId = urlParams.get('id');
            document.getElementById('voteId').value = voteId;
        });

        // 비동기식 폼 제출 처리
        document.getElementById('replyForm').addEventListener('submit', function(event) {
            event.preventDefault();

            const voteId = document.getElementById('voteId').value;
            const content = document.getElementById('content').value;
            const level = document.getElementById('level').value;
            const userId = document.getElementById('userId').value;
            const userNickname = document.getElementById('userNicknameInput').value;

            const replyData = {
                content: content,
                level: level,
                userId: userId,
                userNickname: userNickname
            };

            fetch(`/votes/${voteId}/replies`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(replyData)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
                // 댓글 추가 후 처리 (예: 댓글 목록 갱신)
                alert('댓글이 성공적으로 추가되었습니다.');
                // 여기서 댓글 목록을 갱신하는 코드 추가
            })
            .catch((error) => {
                console.error('Error:', error);
                alert('댓글 추가 중 오류가 발생했습니다.');
            });
        });
    </script>
</body>
</html>
